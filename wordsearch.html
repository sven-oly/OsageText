<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>

  <title>{{language}} wordsearch generator</title>

  <link rel="stylesheet" href="/css/blueprint/screen.css" type="text/css" media="screen">
  <link rel="stylesheet" href="/css/blueprint/print.css" type="text/css" media="print">
  <!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection">
  <![endif]-->

  <link rel="stylesheet" type="text/css" href="/css/fonts.css">

  <script src="/js/osage_utils.js"></script>

  <script src="/js/vk-debug.js"></script>

  <style>
  p, table {
	border: 2px solid #cccccc;
	padding: 5px;
	font-size: 24px;
    font-variant-ligatures: normal;
	}
   .default {
     font-family: "Courier New";
   }
  </style>
<script>

  function sendTestWords(resultArea, answerArea) {
    var wordData = ['𐓏𐒻𐒷𐒻𐒷', '𐓀𐒰𐓓𐒻͘', '𐓏𐒰𐓓𐒰𐓓𐒷', '𐒻𐒷𐓏𐒻͘ ', '𐓈𐒻𐓍𐒷', '𐒹𐓂𐓏𐒷͘𐒼𐒻',
           '𐓇𐓈𐓂͘𐓄𐒰𐓄𐒷', '𐒰̄𐓍𐓣𐓟𐓸𐓟̄𐓛𐓣̄𐓬', '𐒼𐒰𐓆𐒻𐓈𐒰͘', '𐓏𐒰𐓇𐒵𐒻͘𐒿𐒰',
           '𐒻𐓏𐒻𐒼𐒻', '𐓂𐓍𐒰𐒰𐒾𐓎𐓓𐓎𐒼𐒰'];
    return sendWords(wordData, resultArea, answerArea);
  }

  function sendRegionWords(wordSrc, resultArea, answerArea) {
    var inputArea = document.getElementById(wordSrc);
    var wordData = inputArea.value;
    return sendWords(wordData, resultArea, answerArea);
  }

  // Code to request {{language}} data at index with optional filter.
  // Direction indicates previous (-1) or next (+1)
  function sendWords(wordData, resultArea, answerArea) {
    // Prepare for the call to the backendvar xmlhttp;
	if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
	  xmlhttp=new XMLHttpRequest();
	} else { // code for IE6, IE5
	  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	}

    // Deal with the results
    xmlhttp.onreadystatechange=function() {
	  if(xmlhttp.readyState==4) {
        // Handle results
        var returned_json = xmlhttp.responseText;
        var json_obj = JSON.parse(returned_json);
        var outputArea = document.getElementById(resultArea);
        var answersArea = document.getElementById(answerArea);

        words = json_obj.answers;
        grid_width = json_obj.grid_width;
        createGameGrid(json_obj.grid, grid_width, words, json_obj.answers);
      }
    }

    // Prepare and send data.
	target = "/games/generatewordsearch/";
	target += "?words=" + wordData;
    xmlhttp.open("GET", target, true);
	var size = target.length;
	xmlhttp.send(null);
  }

function createGameGrid(grid, grid_width, words, answers) {
    // Create table.
    var table = document.getElementById('gridTable');
    var rows = table.getElementsByTagName("tr")

    // Clear all rows first.
    while (rows.length > 0) {
      table.deleteRow(0);
    }

    // Insert New Row for table at index '0'.

    for (var row = 0; row < grid_width; row ++) {
      var row1 = table.insertRow(row);
      // Insert New Columns for Row1 at index '0'.
      for (var col = 0; col < grid_width; col ++) {
        var row1col1 = row1.insertCell(col);
        row1col1.innerHTML = "\u00a0" + grid[row][col] + "\u00a0";
      }
    }

    // Add the words to find.
    var wordArea = document.getElementById('wordList');
    var wordList = "";
    for (word in words) {
        wordList += "   " + word;
    }
    wordArea.innerHTML = wordList;

    // Prepare answers region
    var answerArea = document.getElementById('answerList');
    for (word in words) {
      answer = answers[word];
      var li = document.createElement("li");
      li.appendChild(document.createTextNode(word + ": " + answer[0]));
      answerArea.appendChild(li);

    }
}

  function toggle(id, toggle) {
    var obj = document.getElementById(id);
    var checkBox = document.getElementById(toggle);
    var showIt = checkBox.checked;
    if(showIt)
      obj.style.display = 'block';
    else
      obj.style.display = 'none';
    }


  // Handle Keyboard
  var controller, visible = true;
  function initKeyboard(textAreaID) {
      var input = document.getElementById(textAreaID);
      controller = new i18n.input.keyboard.Keyboard();
      controller.loadLayout('osa_traditional');
      controller.loadLayout('osa');
      controller.reposition(input, 2, 0, [1, 0, 0, 0]);
      controller.register(input);
      controller.addEventListener('kc', function() { visible = false; });
      input.focus();
      var selector = document.getElementById('selectKeyboard');
      onLayoutSelected(selector, controller, textAreaID);
  }

  function onLayoutSelected(selector, this_controller, outputId) {
    var layoutCode = selector.value;
    if (this_controller) {
      this_controller.activateLayout(layoutCode);
    } else {  // The global.
      controller.activateLayout(layoutCode);
    }
    document.getElementById(outputId).focus();
  }

  function onPageLoaded() {
    initKeyboard("wordlist");
  }
  </script>
</head>


<body onload="onPageLoaded();">
<div class="container">
    <div class="span-1">
    </div>
    <div class="span-16">

        Keyboard: <select onchange="onLayoutSelected(this, null, 'UnicodeOsageTools')")" id="selectKeyboard">
        <option value="osa">Osage Unicode</option>
        </select>
        <div>
            {{language}} Words:<br />
            <textarea id="wordlist">

      </textarea>
        </div>
        <input type="button" value="Clear"
               onclick="clearArea('wordlist');">
        <input type="button" value="Submit"
               onclick="sendRegionWords('wordlist', 'Grid', 'Answers');">
        <input type="button" value="Test"
               onclick="sendTestWords('Grid', 'Answers');">

        </div>
    <div id="printGamearea">
        <div id="divTable" class="break">
            <table id="gridTable">

            </table>
        </div>
        <div>
            <h2>Words to find:</h2>
            <p id="wordList">

            </p>
        </div>

        <div id="answers">
            <h2>Answers:</h2>
            <input type="checkbox" value="Show answers" id="toggleAnswers"
                   onclick="toggle('answerBlock', 'toggleAnswers');"/>
            <div id="answerBlock" style="display:none;">
                <ul id="answerList">
                </ul>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</body>
